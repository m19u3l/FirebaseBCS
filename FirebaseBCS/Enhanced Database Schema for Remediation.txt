-- ===================================
-- REMEDIATION DRYOUT TABLE (Expanded)
-- ===================================
CREATE TABLE IF NOT EXISTS remediation_dryout (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    work_order_id INTEGER NOT NULL,
    project_number TEXT,
    
    -- Loss Information
    loss_date DATE,
    loss_type TEXT, -- Water, Fire, Mold, Sewage, Storm
    loss_category TEXT, -- Category 1 (Clean), 2 (Gray), 3 (Black)
    affected_areas TEXT, -- JSON array of rooms
    
    -- Initial Assessment
    date_of_loss DATE,
    date_notified DATE,
    date_inspection DATE,
    inspection_time TIME,
    inspector_name TEXT,
    
    -- Moisture Readings (JSON with room-by-room data)
    moisture_map TEXT, -- JSON: [{room: "", readings: [{material: "", moisture: "", location: ""}]}]
    initial_moisture_readings TEXT, -- JSON array
    daily_moisture_logs TEXT, -- JSON array by date
    
    -- Environmental Conditions
    temperature_readings TEXT, -- JSON by date
    humidity_readings TEXT, -- JSON by date
    dew_point TEXT,
    
    -- Affected Materials (Detailed breakdown)
    flooring_affected TEXT, -- JSON: {carpet: {sqft: 0, removed: false}, hardwood: {}, tile: {}, etc}
    walls_affected TEXT, -- JSON: {drywall: {sqft: 0, cut_height: ""}, baseboard: {lf: 0}}
    ceiling_affected TEXT,
    insulation_affected TEXT,
    cabinets_affected TEXT,
    doors_affected TEXT,
    trim_affected TEXT,
    
    -- Equipment Deployed
    equipment_list TEXT, -- JSON: [{type: "Dehumidifier", qty: 2, model: "LGR 2800i", location: ""}]
    air_movers_qty INTEGER DEFAULT 0,
    dehumidifiers_qty INTEGER DEFAULT 0,
    air_scrubbers_qty INTEGER DEFAULT 0,
    hepa_vacuums_qty INTEGER DEFAULT 0,
    specialty_equipment TEXT,
    
    -- Demolition Details
    demolition_required BOOLEAN DEFAULT FALSE,
    demolition_scope TEXT, -- Detailed description
    carpet_removed_sqft REAL DEFAULT 0,
    pad_removed_sqft REAL DEFAULT 0,
    baseboard_removed_lf REAL DEFAULT 0,
    drywall_removed_sqft REAL DEFAULT 0,
    drywall_cut_height TEXT, -- e.g., "24 inches", "48 inches", "floor to ceiling"
    insulation_removed_sqft REAL DEFAULT 0,
    ceiling_removed_sqft REAL DEFAULT 0,
    cabinets_removed_qty INTEGER DEFAULT 0,
    vanity_removed_qty INTEGER DEFAULT 0,
    toilet_removed_qty INTEGER DEFAULT 0,
    fixtures_removed TEXT, -- JSON list
    
    -- Contents & Pack-out
    contents_manipulation TEXT, -- Moved, Packed, Stored
    contents_inventory TEXT, -- JSON detailed inventory
    pack_out_required BOOLEAN DEFAULT FALSE,
    pack_out_boxes_qty INTEGER DEFAULT 0,
    storage_required BOOLEAN DEFAULT FALSE,
    storage_location TEXT,
    
    -- Antimicrobial Treatment
    antimicrobial_applied BOOLEAN DEFAULT FALSE,
    antimicrobial_product TEXT,
    antimicrobial_areas TEXT, -- JSON list
    antimicrobial_application_date DATE,
    
    -- Deodorization
    deodorization_required BOOLEAN DEFAULT FALSE,
    deodorization_method TEXT, -- Ozone, Hydroxyl, Thermal Fog, etc.
    deodorization_hours REAL DEFAULT 0,
    
    -- IICRC Documentation
    moisture_dry_standard TEXT, -- Target moisture levels
    drying_goal_achieved BOOLEAN DEFAULT FALSE,
    final_moisture_readings TEXT, -- JSON
    
    -- Timeline
    date_started DATE,
    date_equipment_placed DATE,
    monitoring_dates TEXT, -- JSON array of visit dates
    date_completed DATE,
    total_days_to_dry INTEGER,
    
    -- Health & Safety
    ppe_required TEXT, -- JSON: [respirator, gloves, goggles, etc]
    containment_required BOOLEAN DEFAULT FALSE,
    containment_type TEXT, -- Negative air, plastic sheeting, etc.
    biohazard BOOLEAN DEFAULT FALSE,
    asbestos_present BOOLEAN DEFAULT FALSE,
    lead_present BOOLEAN DEFAULT FALSE,
    
    -- Photos & Documentation
    photo_ids TEXT, -- JSON array of photo references
    thermal_image_ids TEXT,
    moisture_meter_readings_photos TEXT,
    
    -- Insurance Information
    insurance_carrier TEXT,
    claim_number TEXT,
    adjuster_name TEXT,
    adjuster_phone TEXT,
    adjuster_email TEXT,
    policy_number TEXT,
    deductible REAL DEFAULT 0,
    
    -- Costs
    estimated_cost REAL DEFAULT 0,
    actual_cost REAL DEFAULT 0,
    labor_hours REAL DEFAULT 0,
    equipment_rental_days INTEGER DEFAULT 0,
    
    -- Notes
    scope_of_work TEXT, -- Detailed scope
    special_instructions TEXT,
    access_instructions TEXT,
    site_contact_name TEXT,
    site_contact_phone TEXT,
    
    -- Status
    status TEXT DEFAULT 'Active', -- Active, Monitoring, Complete, Billed
    completion_notes TEXT,
    certificate_of_completion TEXT, -- File path or base64
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (work_order_id) REFERENCES work_orders(id)
);

-- ===================================
-- REMEDIATION RECONSTRUCTION TABLE (Expanded)
-- ===================================
CREATE TABLE IF NOT EXISTS remediation_reconstruction (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    dryout_id INTEGER, -- Links to dryout project
    work_order_id INTEGER NOT NULL,
    project_number TEXT,
    
    -- Project Overview
    project_name TEXT,
    project_description TEXT,
    reconstruction_type TEXT, -- Water, Fire, Mold, Storm, Contents
    
    -- Demolition Phase (Detailed)
    demolition_complete BOOLEAN DEFAULT FALSE,
    
    -- FLOORING DEMOLITION
    carpet_demo_sqft REAL DEFAULT 0,
    carpet_demo_rate REAL DEFAULT 0,
    pad_demo_sqft REAL DEFAULT 0,
    pad_demo_rate REAL DEFAULT 0,
    tile_demo_sqft REAL DEFAULT 0,
    tile_demo_rate REAL DEFAULT 0,
    hardwood_demo_sqft REAL DEFAULT 0,
    hardwood_demo_rate REAL DEFAULT 0,
    laminate_demo_sqft REAL DEFAULT 0,
    laminate_demo_rate REAL DEFAULT 0,
    vinyl_demo_sqft REAL DEFAULT 0,
    vinyl_demo_rate REAL DEFAULT 0,
    
    -- WALL DEMOLITION
    drywall_demo_sqft REAL DEFAULT 0,
    drywall_demo_rate REAL DEFAULT 0,
    baseboard_demo_lf REAL DEFAULT 0,
    baseboard_demo_rate REAL DEFAULT 0,
    crown_molding_demo_lf REAL DEFAULT 0,
    crown_molding_demo_rate REAL DEFAULT 0,
    wainscoting_demo_sqft REAL DEFAULT 0,
    wall_tile_demo_sqft REAL DEFAULT 0,
    
    -- CEILING DEMOLITION
    ceiling_drywall_demo_sqft REAL DEFAULT 0,
    ceiling_texture_demo_sqft REAL DEFAULT 0,
    popcorn_ceiling_demo_sqft REAL DEFAULT 0,
    drop_ceiling_demo_sqft REAL DEFAULT 0,
    
    -- CABINETRY & FIXTURES DEMOLITION
    base_cabinets_demo_lf REAL DEFAULT 0,
    upper_cabinets_demo_lf REAL DEFAULT 0,
    countertop_demo_lf REAL DEFAULT 0,
    vanity_demo_qty INTEGER DEFAULT 0,
    vanity_top_demo_qty INTEGER DEFAULT 0,
    
    -- PLUMBING DEMOLITION
    toilet_demo_qty INTEGER DEFAULT 0,
    sink_demo_qty INTEGER DEFAULT 0,
    faucet_demo_qty INTEGER DEFAULT 0,
    shower_valve_demo_qty INTEGER DEFAULT 0,
    tub_demo_qty INTEGER DEFAULT 0,
    water_heater_demo_qty INTEGER DEFAULT 0,
    
    -- DOOR & WINDOW DEMOLITION
    interior_door_demo_qty INTEGER DEFAULT 0,
    exterior_door_demo_qty INTEGER DEFAULT 0,
    window_demo_qty INTEGER DEFAULT 0,
    sliding_door_demo_qty INTEGER DEFAULT 0,
    
    -- INSULATION DEMOLITION
    batt_insulation_demo_sqft REAL DEFAULT 0,
    blown_insulation_demo_sqft REAL DEFAULT 0,
    spray_foam_demo_sqft REAL DEFAULT 0,
    
    -- RECONSTRUCTION PHASE
    reconstruction_complete BOOLEAN DEFAULT FALSE,
    
    -- FRAMING & STRUCTURAL
    wall_framing_lf REAL DEFAULT 0,
    wall_framing_rate REAL DEFAULT 0,
    ceiling_framing_sqft REAL DEFAULT 0,
    headers_installed INTEGER DEFAULT 0,
    blocking_installed_lf REAL DEFAULT 0,
    
    -- PLUMBING INSTALLATION
    plumbing_rough_in TEXT, -- Description
    water_lines_installed_lf REAL DEFAULT 0,
    drain_lines_installed_lf REAL DEFAULT 0,
    toilet_install_qty INTEGER DEFAULT 0,
    toilet_cost_ea REAL DEFAULT 0,
    sink_install_qty INTEGER DEFAULT 0,
    sink_cost_ea REAL DEFAULT 0,
    faucet_install_qty INTEGER DEFAULT 0,
    faucet_cost_ea REAL DEFAULT 0,
    shower_valve_install_qty INTEGER DEFAULT 0,
    tub_install_qty INTEGER DEFAULT 0,
    water_heater_install_qty INTEGER DEFAULT 0,
    
    -- ELECTRICAL INSTALLATION
    electrical_rough_in TEXT,
    outlets_installed_qty INTEGER DEFAULT 0,
    switches_installed_qty INTEGER DEFAULT 0,
    light_fixtures_qty INTEGER DEFAULT 0,
    gfci_outlets_qty INTEGER DEFAULT 0,
    electrical_panel_work TEXT,
    
    -- HVAC
    hvac_work_description TEXT,
    ductwork_installed_lf REAL DEFAULT 0,
    vents_installed_qty INTEGER DEFAULT 0,
    returns_installed_qty INTEGER DEFAULT 0,
    
    -- INSULATION INSTALLATION
    batt_insulation_install_sqft REAL DEFAULT 0,
    batt_insulation_rate REAL DEFAULT 0,
    blown_insulation_install_sqft REAL DEFAULT 0,
    spray_foam_install_sqft REAL DEFAULT 0,
    
    -- DRYWALL INSTALLATION
    drywall_hang_sqft REAL DEFAULT 0,
    drywall_hang_rate REAL DEFAULT 0,
    drywall_finish_sqft REAL DEFAULT 0,
    drywall_finish_rate REAL DEFAULT 0,
    drywall_texture_sqft REAL DEFAULT 0,
    drywall_texture_type TEXT, -- Knockdown, Orange Peel, Smooth, Popcorn
    corner_bead_lf REAL DEFAULT 0,
    
    -- CEILING WORK
    ceiling_drywall_hang_sqft REAL DEFAULT 0,
    ceiling_texture_sqft REAL DEFAULT 0,
    ceiling_texture_type TEXT,
    drop_ceiling_install_sqft REAL DEFAULT 0,
    
    -- PAINTING
    primer_walls_sqft REAL DEFAULT 0,
    primer_rate REAL DEFAULT 0,
    paint_walls_sqft REAL DEFAULT 0,
    paint_walls_rate REAL DEFAULT 0,
    paint_walls_coats INTEGER DEFAULT 2,
    paint_ceiling_sqft REAL DEFAULT 0,
    paint_ceiling_rate REAL DEFAULT 0,
    paint_trim_lf REAL DEFAULT 0,
    paint_doors_qty INTEGER DEFAULT 0,
    paint_color_scheme TEXT, -- JSON with room colors
    
    -- TRIM & MILLWORK
    baseboard_install_lf REAL DEFAULT 0,
    baseboard_type TEXT, -- MDF, Wood, etc.
    baseboard_rate REAL DEFAULT 0,
    crown_molding_install_lf REAL DEFAULT 0,
    crown_molding_rate REAL DEFAULT 0,
    door_casing_install_qty INTEGER DEFAULT 0,
    window_casing_install_qty INTEGER DEFAULT 0,
    wainscoting_install_sqft REAL DEFAULT 0,
    chair_rail_install_lf REAL DEFAULT 0,
    
    -- DOORS & WINDOWS
    interior_door_install_qty INTEGER DEFAULT 0,
    interior_door_type TEXT,
    interior_door_cost_ea REAL DEFAULT 0,
    exterior_door_install_qty INTEGER DEFAULT 0,
    exterior_door_cost_ea REAL DEFAULT 0,
    window_install_qty INTEGER DEFAULT 0,
    window_type TEXT,
    window_cost_ea REAL DEFAULT 0,
    sliding_door_install_qty INTEGER DEFAULT 0,
    
    -- FLOORING INSTALLATION
    carpet_install_sqft REAL DEFAULT 0,
    carpet_type TEXT,
    carpet_rate REAL DEFAULT 0,
    pad_install_sqft REAL DEFAULT 0,
    pad_type TEXT,
    pad_rate REAL DEFAULT 0,
    
    tile_install_sqft REAL DEFAULT 0,
    tile_type TEXT,
    tile_rate REAL DEFAULT 0,
    tile_size TEXT,
    grout_color TEXT,
    
    hardwood_install_sqft REAL DEFAULT 0,
    hardwood_type TEXT, -- Oak, Maple, etc.
    hardwood_rate REAL DEFAULT 0,
    hardwood_finish TEXT,
    
    laminate_install_sqft REAL DEFAULT 0,
    laminate_type TEXT,
    laminate_rate REAL DEFAULT 0,
    
    vinyl_install_sqft REAL DEFAULT 0,
    vinyl_type TEXT, -- LVP, Sheet, etc.
    vinyl_rate REAL DEFAULT 0,
    
    transition_strips_qty INTEGER DEFAULT 0,
    floor_prep_sqft REAL DEFAULT 0,
    subfloor_repair_sqft REAL DEFAULT 0,
    
    -- TILE WORK (Detailed)
    wall_tile_install_sqft REAL DEFAULT 0,
    wall_tile_type TEXT,
    wall_tile_rate REAL DEFAULT 0,
    backsplash_install_sqft REAL DEFAULT 0,
    backsplash_type TEXT,
    shower_tile_sqft REAL DEFAULT 0,
    tub_surround_sqft REAL DEFAULT 0,
    
    -- CABINETRY & COUNTERTOPS
    base_cabinets_install_lf REAL DEFAULT 0,
    base_cabinet_type TEXT, -- Stock, Semi-Custom, Custom
    base_cabinet_cost_lf REAL DEFAULT 0,
    upper_cabinets_install_lf REAL DEFAULT 0,
    upper_cabinet_cost_lf REAL DEFAULT 0,
    cabinet_hardware TEXT, -- Knobs, Pulls
    hardware_cost REAL DEFAULT 0,
    
    countertop_install_lf REAL DEFAULT 0,
    countertop_material TEXT, -- Granite, Quartz, Laminate, etc.
    countertop_cost_lf REAL DEFAULT 0,
    backsplash_height REAL DEFAULT 4, -- inches
    
    vanity_install_qty INTEGER DEFAULT 0,
    vanity_size TEXT,
    vanity_cost_ea REAL DEFAULT 0,
    vanity_top_material TEXT,
    vanity_top_cost_ea REAL DEFAULT 0,
    
    -- SPECIALTY WORK
    shower_pan_install_qty INTEGER DEFAULT 0,
    shower_door_install_qty INTEGER DEFAULT 0,
    shower_door_type TEXT, -- Frameless, Semi-frameless, Framed
    tub_install_qty INTEGER DEFAULT 0,
    tub_type TEXT,
    tub_cost_ea REAL DEFAULT 0,
    
    -- FINAL TOUCHES
    caulking_complete BOOLEAN DEFAULT FALSE,
    touch_up_paint_complete BOOLEAN DEFAULT FALSE,
    final_clean_complete BOOLEAN DEFAULT FALSE,
    punch_list TEXT, -- JSON array of items
    
    -- PERMITS & INSPECTIONS
    permits_required TEXT, -- JSON: [Building, Electrical, Plumbing]
    permit_numbers TEXT,
    inspections_passed TEXT, -- JSON with dates
    final_inspection_date DATE,
    certificate_of_occupancy BOOLEAN DEFAULT FALSE,
    
    -- MATERIALS USED (Detailed tracking)
    materials_list TEXT, -- JSON: [{item: "", qty: 0, unit: "", cost: 0, supplier: ""}]
    
    -- LABOR TRACKING
    labor_breakdown TEXT, -- JSON: [{trade: "", hours: 0, rate: 0, total: 0}]
    general_contractor_hours REAL DEFAULT 0,
    carpenter_hours REAL DEFAULT 0,
    electrician_hours REAL DEFAULT 0,
    plumber_hours REAL DEFAULT 0,
    hvac_tech_hours REAL DEFAULT 0,
    drywall_hanger_hours REAL DEFAULT 0,
    taper_hours REAL DEFAULT 0,
    painter_hours REAL DEFAULT 0,
    tile_setter_hours REAL DEFAULT 0,
    flooring_installer_hours REAL DEFAULT 0,
    
    -- SUBCONTRACTORS
    subcontractor_list TEXT, -- JSON: [{name: "", trade: "", cost: 0, scope: ""}]
    
    -- TIMELINE
    demo_start_date DATE,
    demo_completion_date DATE,
    reconstruction_start_date DATE,
    substantial_completion_date DATE,
    final_completion_date DATE,
    total_project_days INTEGER,
    
    -- COSTS & BILLING
    total_demo_cost REAL DEFAULT 0,
    total_material_cost REAL DEFAULT 0,
    total_labor_cost REAL DEFAULT 0,
    total_subcontractor_cost REAL DEFAULT 0,
    total_equipment_cost REAL DEFAULT 0,
    total_permit_cost REAL DEFAULT 0,
    overhead_percentage REAL DEFAULT 10,
    profit_margin_percentage REAL DEFAULT 10,
    estimated_total REAL DEFAULT 0,
    actual_total REAL DEFAULT 0,
    
    -- CHANGE ORDERS
    change_orders_total REAL DEFAULT 0,
    change_orders_qty INTEGER DEFAULT 0,
    
    -- INSURANCE
    insurance_carrier TEXT,
    claim_number TEXT,
    adjuster_name TEXT,
    xactimate_estimate_number TEXT,
    
    -- QUALITY CONTROL
    progress_photos TEXT, -- JSON array
    final_photos TEXT,
    client_walkthrough_date DATE,
    client_satisfaction_score INTEGER, -- 1-5
    warranty_provided TEXT,
    warranty_period_months INTEGER DEFAULT 12,
    
    -- STATUS
    status TEXT DEFAULT 'Planning', -- Planning, Demo, Reconstruction, Punch List, Complete
    completion_certificate TEXT,
    final_invoice_sent BOOLEAN DEFAULT FALSE,
    payment_received BOOLEAN DEFAULT FALSE,
    
    -- NOTES
    scope_of_work TEXT,
    special_requirements TEXT,
    site_conditions TEXT,
    project_notes TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    FOREIGN KEY (dryout_id) REFERENCES remediation_dryout(id),
    FOREIGN KEY (work_order_id) REFERENCES work_orders(id)
);

-- ===================================
-- DAILY LOGS TABLE
-- ===================================
CREATE TABLE IF NOT EXISTS daily_project_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    project_type TEXT, -- dryout or reconstruction
    log_date DATE NOT NULL,
    technician_name TEXT,
    
    -- Activities
    work_performed TEXT,
    equipment_checked TEXT, -- JSON
    moisture_readings TEXT, -- JSON
    crew_members TEXT, -- JSON array
    hours_worked REAL DEFAULT 0,
    
    -- Observations
    weather_conditions TEXT,
    site_conditions TEXT,
    issues_encountered TEXT,
    
    -- Photos
    photo_ids TEXT, -- JSON array
    
    -- Next Steps
    next_visit_planned DATE,
    notes TEXT,
    
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ===================================
-- EQUIPMENT USAGE LOG
-- ===================================
CREATE TABLE IF NOT EXISTS equipment_usage_log (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    project_type TEXT,
    equipment_type TEXT,
    equipment_model TEXT,
    serial_number TEXT,
    quantity INTEGER DEFAULT 1,
    date_deployed DATE,
    date_retrieved DATE,
    days_used INTEGER,
    rental_rate_per_day REAL DEFAULT 0,
    total_rental_cost REAL DEFAULT 0,
    location TEXT, -- Where in the property
    readings_log TEXT, -- JSON for daily readings
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ===================================
-- PHOTO DOCUMENTATION
-- ===================================
CREATE TABLE IF NOT EXISTS project_photos (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    project_id INTEGER NOT NULL,
    project_type TEXT,
    photo_type TEXT, -- Before, During, After, Thermal, Moisture
    room_location TEXT,
    description TEXT,
    file_path TEXT,
    thumbnail_path TEXT,
    taken_date DATETIME,
    taken_by TEXT,
    metadata TEXT, -- JSON: camera, settings, GPS, etc.
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ===================================
-- MOISTURE READINGS LOG
-- ===================================
CREATE TABLE IF NOT EXISTS moisture_readings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    dryout_id INTEGER NOT NULL,
    reading_date DATE NOT NULL,
    room TEXT,
    material_type TEXT, -- Drywall, Concrete, Wood, Carpet, etc.
    location_description TEXT,
    moisture_percentage REAL,
    reading_number INTEGER, -- Sequential for tracking
    meter_type TEXT, -- Pin-type, Pinless
    target_moisture REAL, -- Dry standard goal
    dry BOOLEAN DEFAULT FALSE,
    notes TEXT,
    technician TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (dryout_id) REFERENCES remediation_dryout(id)
);